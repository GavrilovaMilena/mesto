(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e,n,r,o,i,u,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=e.name,this._img=e.link,this._cardSelector=document.querySelector(r),this._openPopupFull=o,this._ownerId=e.owner._id,this._imageId=e._id,this._likes=e.likes,this._userId=n,this._deleteHandler=i,this._addLike=u,this._removeLike=a}var n,r;return n=t,(r=[{key:"_getTemplate",value:function(){return this._cardSelector.content.querySelector(".card").cloneNode(!0)}},{key:"_cardLikeToggle",value:function(e){e.target.classList.contains("card__like_active")?(this._element.querySelector(".card__like").classList.remove("card__like_active"),this._removeLike()):(this._element.querySelector(".card__like").classList.add("card__like_active"),this._addLike())}},{key:"_handleTrashButton",value:function(e){e.remove(),e=null}},{key:"_сardOwner",value:function(){this._data.owner._id!==this._ownerId&&this._handleTrashButton(this._delete)}},{key:"setLikesCounter",value:function(e){this._likesCounter.textContent=String(e.likes.length)}},{key:"generateCard",value:function(){var e=this;return this._element=this._getTemplate(),this._deleteButton=this._element.querySelector(".card__delete"),this._cardImage=this._element.querySelector(".card__image"),this._element.querySelector(".card__text").textContent=this._name,this._cardImage.src=this._img,this._cardImage.alt=this._name,this._element.querySelector(".card__like-counter").textContent=this._likes.length,this._likes.forEach((function(t){t._id===e._userId&&e._element.querySelector(".card__like").classList.add("card__like_active")})),this._setEventListeners(),this.checkId(),this._element}},{key:"checkId",value:function(){this._ownerId!==this._userId&&this._deleteButton.remove()}},{key:"removeCard",value:function(){this._element.remove()}},{key:"returnCardId",value:function(){return this._imageId}},{key:"changeLikesCounter",value:function(e){this._element.querySelector(".card__like-counter").textContent=e}},{key:"_setEventListeners",value:function(){var e=this;this._cardImage.addEventListener("click",(function(){e._openPopupFull(e._img,e._name)})),this._element.querySelector(".card__like").addEventListener("click",(function(t){e._cardLikeToggle(t)})),this._deleteButton.addEventListener("click",(function(t){e._deleteHandler(t)}))}}])&&e(n.prototype,r),t}();function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._validations=t,this._submitButton=n.querySelector(this._validations.submitButtonSelector),this._formElement=n}var t,r;return t=e,(r=[{key:"_showError",value:function(e){this._formElement.querySelector("#".concat(e.id,"-error")).textContent=e.validationMessage,e.classList.add(this._validations.inputInvalidClass)}},{key:"_hideError",value:function(e){this._formElement.querySelector("#".concat(e.id,"-error")).textContent="",e.classList.remove(this._validations.inputInvalidClass)}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideError(e):this._showError(e)}},{key:"setButtonState",value:function(){this._formElement.checkValidity()?(this._submitButton.classList.remove(this._validations.buttonInvalidClass),this._submitButton.disabled=!1):(this._submitButton.classList.add(this._validations.buttonInvalidClass),this._submitButton.disabled="disabled")}},{key:"_setEventListener",value:function(){var e=this,t=this._formElement.querySelectorAll(this._validations.inputSelector);t.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e.setButtonState()}))})),this._formElement.addEventListener("reset",(function(){t.forEach((function(t){e._hideError(t),e.setButtonState()}))}))}},{key:"enableValidation",value:function(){this._formElement.addEventListener("submit",(function(e){e.preventDefault()})),this.setButtonState(),this._setEventListener(this._formElement)}}])&&n(t.prototype,r),e}();function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderer=t,this._container=document.querySelector(n)}var t,n;return t=e,(n=[{key:"renderItems",value:function(e){var t=this;e.forEach((function(e){t._renderer(e)}))}},{key:"addItem",value:function(e){this._container.prepend(e)}}])&&o(t.prototype,n),e}();function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this._popupCloseButton=this._popup.querySelector(".popup__close-button"),this._handleEscClose=this._handleEscClose.bind(this),this._handleOverlayClose=this._handleOverlayClose.bind(this),this._handleButtonClose=this._handleButtonClose.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_visible"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_visible"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"_handleOverlayClose",value:function(e){e.target.classList.contains("popup_visible")&&this.close()}},{key:"_handleButtonClose",value:function(){this.close()}},{key:"setEventListeners",value:function(){this._popupCloseButton.addEventListener("click",this._handleButtonClose),this._popup.addEventListener("click",this._handleOverlayClose)}}])&&u(t.prototype,n),e}();function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?h(e):t}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=_(r);if(o){var n=_(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return p(this,e)});function u(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),console.log(e),(n=i.call(this,e))._formElement=n._popup.querySelector(".popup__form"),n._handleForm=t,n._submit=n._submit.bind(h(n)),n}return t=u,(n=[{key:"_submit",value:function(e){e.preventDefault(),this._handleForm(this._getInputValues())}},{key:"_getInputValues",value:function(){var e=this;return this._inputList=Array.from(this._formElement.querySelectorAll(".popup__input")),this._formValues={},this._inputList.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"setEventListeners",value:function(){l(_(u.prototype),"setEventListeners",this).call(this),this._formElement.addEventListener("submit",this._submit)}},{key:"close",value:function(){l(_(u.prototype),"close",this).call(this),this._formElement.reset()}}])&&s(t.prototype,n),u}(a);function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t,n){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=g(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var S=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=g(r);if(o){var n=g(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return k(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e))._fullImage=t._popup.querySelector(".popup__full-image"),t._fullText=t._popup.querySelector(".popup__full-text"),t}return t=u,(n=[{key:"open",value:function(e,t){m(g(u.prototype),"open",this).call(this),this._fullImage.src=e,this._fullImage.alt=t,this._fullText.textContent=t}}])&&v(t.prototype,n),u}(a);function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._nameUser=document.querySelector(t),this._about=document.querySelector(n),this._avatar=document.querySelector(r)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this._nameUser.textContent,about:this._about.textContent}}},{key:"setAvatar",value:function(e){this._avatar.src=e.avatar}},{key:"setUserInfo",value:function(e){this._nameUser.textContent=e.infoTitle,this._about.textContent=e.infoSubtitle}},{key:"setInitialInfo",value:function(e,t,n){this._nameUser.textContent=e,this._about.textContent=t,this._avatar.src=n}},{key:"setUserId",value:function(e){this._userId=e}},{key:"returnUserId",value:function(){return this._userId}}])&&E(t.prototype,n),e}();function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var L=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._url=t.url,this._headers=t.headers}var t,n;return t=e,(n=[{key:"getInitialCards",value:function(){return fetch("".concat(this._url,"/cards"),{headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"getUserInfo",value:function(){return fetch("".concat(this._url,"/users/me"),{headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"setUserInfo",value:function(e,t){return fetch("".concat(this._url,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"addCard",value:function(e,t){return fetch("".concat(this._url,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"deleteCard",value:function(e){return fetch("".concat(this._url,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"updateAvatarImage",value:function(e){return fetch("".concat(this._url,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"addLike",value:function(e){return fetch("".concat(this._url,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"removeLike",value:function(e){return fetch("".concat(this._url,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}}])&&C(t.prototype,n),e}();function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e,t,n){return(j="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=T(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function q(e,t){return!t||"object"!==I(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=T(r);if(o){var n=T(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return q(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e))._popupWithSubmitDelete=document.querySelector(".popup__button_delete-card"),t}return t=u,(n=[{key:"open",value:function(e){j(T(u.prototype),"open",this).call(this),this._handleButtonSubmit=e,this._popupWithSubmitDelete.addEventListener("click",this._handleButtonSubmit)}},{key:"close",value:function(){j(T(u.prototype),"close",this).call(this),this._popupWithSubmitDelete.removeEventListener("click",this._handleButtonSubmit)}}])&&O(t.prototype,n),u}(a),R=document.querySelector(".info__button"),x=document.querySelector(".profile__add-button"),U=document.querySelector(".profile__avatar-button"),D=document.querySelector(".popup__form_card"),V=(document.querySelector('.popup__input_card[name="cardName"]'),document.querySelector('.popup__input_card[name="cardLink"]'),document.querySelector(".popup__form")),A=document.querySelector('.popup__input[name="infoTitle"]'),N=document.querySelector('.popup__input[name="infoSubtitle"]'),F=document.querySelector(".popup__form_avatar"),H=(document.querySelector('.popup__input_avatar[name="avatar"]'),document.querySelector(".popup_delete-card"),{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputInvalidClass:"popup__input_state-invalid",buttonInvalidClass:"popup__button_invalid"}),J=new L({url:"https://mesto.nomoreparties.co/v1/cohort-20",headers:{authorization:"525a9253-bff1-4ef9-85d2-df3d4a503fec","Content-Type":"application/json"}}),W=new r(H,D);W.enableValidation();var z=new r(H,V);z.enableValidation();var M=new r(H,F);M.enableValidation();var G=new w(".info__title",".info__subtitle",".profile__avatar"),K=new S(".popup_full");K.setEventListeners();var Q=new d(".popup_profile",(function(e){ne(".popup_profile",!0);var t={name:A.value,about:N.value};J.setUserInfo(t.name,t.about).then((function(){G.setUserInfo(e),ne(".popup_profile",!1)})).catch((function(e){console.log(e)})),Q.close()}));Q.setEventListeners();var X=new d(".popup_card",(function(e){ne(".popup_card",!0),J.addCard(e.cardName,e.cardLink).then((function(e){ee.addItem(te(e)),ne(".popup_card",!1)})).catch((function(e){console.log(e)})),X.close()}));X.setEventListeners();var Y=new d(".popup_avatar",(function(e){ne(".popup_avatar",!0),J.updateAvatarImage(e.avatar).then((function(){G.setAvatar(e),ne(".popup_avatar",!1)})).catch((function(e){console.log(e)})),Y.close()}));Y.setEventListeners(),R.addEventListener("click",(function(){var e=G.getUserInfo();A.value=e.name,N.value=e.about,z.setButtonState(),Q.open()})),x.addEventListener("click",(function(){W.setButtonState(),X.open()})),U.addEventListener("click",(function(){M.setButtonState(),Y.open()}));var Z=function(e,t){K.open(e,t)},$=new B(".popup_delete-card"),ee=new i((function(e){ee.addItem(te(e))}),".cards");function te(e){var n=new t(e,G.returnUserId(),".template",Z,(function(){$.setEventListeners(function(e){return function(){J.deleteCard(e.returnCardId()).then((function(){$.close(),e.removeCard()})).catch((function(e){console.log(e)}))}}(n)),$.open()}),(function(){J.addLike(n.returnCardId()).then((function(e){return n.changeLikesCounter(e.likes.length)}))}),(function(){J.removeLike(n.returnCardId()).then((function(e){return n.changeLikesCounter(e.likes.length)}))}));return n.generateCard()}function ne(e,t){document.querySelector(e).querySelector(".popup__button ").textContent=t?"Сохранение...":".popup_card"===e?"Создать":"Сохранить"}J.getInitialCards().then((function(e){console.log(e),ee.renderItems(e)})).catch((function(e){console.log(e)})),J.getUserInfo().then((function(e){G.setInitialInfo(e.name,e.about,e.avatar),G.setUserId(e._id)})).catch((function(e){console.log(e)}))})();